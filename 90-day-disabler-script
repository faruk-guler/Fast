$When = (Get-Date).AddDays(-90).ToFileTimeUtc()

Get-ADUser -Filter * -SearchBase "OU=IT_Personal,DC=guler,DC=com" `
    -SearchScope Subtree -Properties SamAccountName, LastLogonTimestamp, Enabled |
Where-Object {
    ($_.LastLogonTimestamp -ne $null) -and
    ($_.LastLogonTimestamp -lt $When) -and
    ($_.Enabled -eq $true) -and
    ($_.SamAccountName -ne "faruk") # <-- Excluded User
} |
ForEach-Object {
    Disable-ADAccount -Identity $_.SamAccountName
}

# ⚠️ UYARI: Bu betik `LastLogonTimestamp` kullanır — 14 güne varan gecikme olabilir!
# Son 14 gün içinde giriş yapmış kullanıcılar YANLIŞLIKLA devre dışı kalabilir.
# Kritik ortamlarda "lastLogon" + tüm DC'leri sorgulayan güvenli versiyon tercih edilmelidir.
